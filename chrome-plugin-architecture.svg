<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1400 2000">
  <defs>
    <style>
      .title { font: bold 28px sans-serif; fill: #1a1a1a; }
      .subtitle { font: bold 20px sans-serif; fill: #2563eb; }
      .section-title { font: bold 16px sans-serif; fill: #1a1a1a; }
      .text { font: 14px sans-serif; fill: #4a4a4a; }
      .small-text { font: 12px sans-serif; fill: #666; }
      .code { font: 12px monospace; fill: #d73a49; }
      .box { fill: #f8fafc; stroke: #cbd5e1; stroke-width: 2; }
      .manifest-box { fill: #fef3c7; stroke: #fbbf24; stroke-width: 2; }
      .background-box { fill: #dbeafe; stroke: #3b82f6; stroke-width: 2; }
      .content-box { fill: #dcfce7; stroke: #22c55e; stroke-width: 2; }
      .ui-box { fill: #fce7f3; stroke: #ec4899; stroke-width: 2; }
      .arrow { fill: none; stroke: #64748b; stroke-width: 2; marker-end: url(#arrowhead); }
      .arrow-important { fill: none; stroke: #dc2626; stroke-width: 3; marker-end: url(#arrowhead-red); }
      .arrow-data { fill: none; stroke: #16a34a; stroke-width: 2.5; marker-end: url(#arrowhead-green); }
      .number-circle { fill: #3b82f6; stroke: #1e40af; stroke-width: 2; }
      .number-text { font: bold 16px sans-serif; fill: white; text-anchor: middle; }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#64748b" />
    </marker>
    <marker id="arrowhead-red" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#dc2626" />
    </marker>
    <marker id="arrowhead-green" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#16a34a" />
    </marker>
  </defs>

  <!-- Title -->
  <text x="700" y="40" class="title" text-anchor="middle">Chrome çˆ¬è™«æ’ä»¶æ ¸å¿ƒå·¥ä½œåŸç†</text>
  <text x="700" y="65" class="small-text" text-anchor="middle">ä»¥ Twitter Scraper ä¸ºä¾‹ - å®Œæ•´æ•°æ®æµå‘è§£æ</text>

  <!-- Phase 1: Manifest -->
  <rect x="50" y="100" width="1300" height="180" class="manifest-box" rx="8"/>
  <circle cx="80" cy="130" r="18" class="number-circle"/>
  <text x="80" y="137" class="number-text">1</text>
  <text x="110" y="137" class="subtitle">Manifest é…ç½® (æ’ä»¶å…¥å£)</text>
  
  <text x="80" y="165" class="section-title">manifest.json - æ’ä»¶çš„"èº«ä»½è¯"</text>
  <text x="100" y="190" class="text">â€¢ manifest_version: 3 (Chromeæ‰©å±•V3è§„èŒƒ)</text>
  <text x="100" y="210" class="text">â€¢ permissions: ["activeTab", "scripting", "sidePanel", "storage"]</text>
  <text x="100" y="230" class="text">â€¢ host_permissions: ["https://twitter.com/*", "https://x.com/*"] - æˆæƒè®¿é—®çš„ç½‘ç«™</text>
  <text x="100" y="250" class="text">â€¢ content_scripts: å®šä¹‰æ³¨å…¥è„šæœ¬ (src/content.ts)</text>
  <text x="100" y="270" class="text">â€¢ background: åå°æœåŠ¡ (src/background.ts) + side_panel: UIé¢æ¿</text>

  <!-- Phase 2: Background Script -->
  <rect x="50" y="310" width="630" height="220" class="background-box" rx="8"/>
  <circle cx="80" cy="340" r="18" class="number-circle"/>
  <text x="80" y="347" class="number-text">2</text>
  <text x="110" y="347" class="subtitle">Background Script (åå°ç®¡ç†)</text>
  
  <text x="80" y="375" class="section-title">src/background.ts - å…¨å±€è°ƒåº¦ä¸­å¿ƒ</text>
  <text x="100" y="400" class="text">åŠŸèƒ½ï¼šç®¡ç†Side Panelçš„æ˜¾ç¤º/éšè—</text>
  <text x="100" y="425" class="code">chrome.tabs.onUpdated.addListener()</text>
  <text x="100" y="445" class="small-text">â†’ ç›‘å¬æ ‡ç­¾é¡µURLå˜åŒ–</text>
  <text x="100" y="465" class="small-text">â†’ å¦‚æœæ˜¯twitter.com/x.com: å¯ç”¨Side Panel</text>
  <text x="100" y="485" class="small-text">â†’ å¦‚æœæ˜¯å…¶ä»–ç½‘ç«™: ç¦ç”¨Side Panel</text>
  <text x="100" y="510" class="text">ç”Ÿå‘½å‘¨æœŸï¼šå§‹ç»ˆè¿è¡Œåœ¨æµè§ˆå™¨åå°</text>

  <!-- Phase 3: Content Script -->
  <rect x="720" y="310" width="630" height="340" class="content-box" rx="8"/>
  <circle cx="750" cy="340" r="18" class="number-circle"/>
  <text x="750" y="347" class="number-text">3</text>
  <text x="780" y="347" class="subtitle">Content Script (æ•°æ®é‡‡é›†æ ¸å¿ƒ)</text>
  
  <text x="750" y="375" class="section-title">src/content.ts - æ³¨å…¥åˆ°ç½‘é¡µçš„è„šæœ¬</text>
  <text x="770" y="400" class="text">å…³é”®å˜é‡ï¼š</text>
  <text x="790" y="420" class="code">let isScraping = false</text>
  <text x="790" y="440" class="code">let scrapedTweets = new Map&lt;string, Tweet&gt;()</text>
  <text x="790" y="460" class="code">const scraper = createScraper(window.location.hostname)</text>
  
  <text x="770" y="490" class="text">æ ¸å¿ƒæµç¨‹ï¼š</text>
  <text x="790" y="510" class="small-text">â‘  ç›‘å¬æ¶ˆæ¯ chrome.runtime.onMessage.addListener()</text>
  <text x="790" y="530" class="small-text">â‘¡ æ”¶åˆ°START_SCRAPE â†’ å¯åŠ¨å®šæ—¶å™¨ (æ¯600ms)</text>
  <text x="790" y="550" class="small-text">â‘¢ è°ƒç”¨ scraper.scrape() è§£æDOM</text>
  <text x="790" y="570" class="small-text">â‘£ è‡ªåŠ¨æ»šåŠ¨é¡µé¢ window.scrollBy()</text>
  <text x="790" y="590" class="small-text">â‘¤ å»é‡åå‘é€æ•°æ® chrome.runtime.sendMessage()</text>
  <text x="790" y="610" class="small-text">â‘¥ æ”¶åˆ°STOP_SCRAPE â†’ åœæ­¢å®šæ—¶å™¨</text>
  <text x="790" y="635" class="text" font-weight="bold">ç”Ÿå‘½å‘¨æœŸï¼šéšç½‘é¡µåŠ è½½è€Œæ³¨å…¥ï¼Œéšç½‘é¡µå…³é—­è€Œé”€æ¯</text>

  <!-- Arrow: Background to Content -->
  <path d="M 365 420 L 710 420" class="arrow"/>
  <text x="500" y="415" class="small-text">ç®¡ç†ç”Ÿå‘½å‘¨æœŸ</text>

  <!-- Phase 4: Scraper -->
  <rect x="720" y="680" width="630" height="280" class="content-box" rx="8"/>
  <circle cx="750" cy="710" r="18" class="number-circle"/>
  <text x="750" y="717" class="number-text">4</text>
  <text x="780" y="717" class="subtitle">Scraper è§£æå™¨ (æ•°æ®æå–)</text>
  
  <text x="750" y="745" class="section-title">src/scrapers/TwitterScraper.ts</text>
  <text x="770" y="770" class="text">æ ¸å¿ƒæ–¹æ³•ï¼šscrape(existingIds?: Set&lt;string&gt;): Tweet[]</text>
  
  <text x="770" y="800" class="text">æ•°æ®æå–æ­¥éª¤ï¼š</text>
  <text x="790" y="820" class="code">1. document.querySelectorAll('article[data-testid="tweet"]')</text>
  <text x="790" y="840" class="small-text">   â†’ æ‰¾åˆ°é¡µé¢ä¸Šæ‰€æœ‰æ¨æ–‡DOMèŠ‚ç‚¹</text>
  <text x="790" y="865" class="code">2. ä»æ¯ä¸ªarticleä¸­æå–ï¼š</text>
  <text x="810" y="885" class="small-text">â€¢ ä½œè€…ä¿¡æ¯ (name, handle)</text>
  <text x="810" y="905" class="small-text">â€¢ æ—¶é—´æˆ³ &lt;time datetime&gt;</text>
  <text x="810" y="925" class="small-text">â€¢ æ¨æ–‡å†…å®¹ div[data-testid="tweetText"]</text>
  <text x="810" y="945" class="small-text">â€¢ äº’åŠ¨æ•°æ® (likes, reposts, replies, views)</text>

  <!-- Arrow: Content to Scraper -->
  <path d="M 1035 650 L 1035 680" class="arrow-important"/>
  <text x="1045" y="670" class="small-text" fill="#dc2626">è°ƒç”¨scrape()</text>

  <!-- Phase 5: Side Panel UI -->
  <rect x="50" y="680" width="630" height="360" class="ui-box" rx="8"/>
  <circle cx="80" cy="710" r="18" class="number-circle"/>
  <text x="80" y="717" class="number-text">5</text>
  <text x="110" y="717" class="subtitle">Side Panel UI (ç”¨æˆ·ç•Œé¢)</text>
  
  <text x="80" y="745" class="section-title">src/sidepanel.tsx + App.tsx (Reactåº”ç”¨)</text>
  <text x="100" y="775" class="text">UIç»„ä»¶æ¶æ„ï¼š</text>
  <text x="120" y="795" class="small-text">â€¢ Header: æ§åˆ¶æŒ‰é’®ï¼ˆå¼€å§‹/åœæ­¢ã€å¯¼å‡ºã€æ¸…ç©ºï¼‰</text>
  <text x="120" y="815" class="small-text">â€¢ StatsCard: ç»Ÿè®¡æ•°æ®ï¼ˆæ€»æ•°ã€ç‚¹èµæ•°ã€è½¬å‘æ•°ç­‰ï¼‰</text>
  <text x="120" y="835" class="small-text">â€¢ FilterControls: è¿‡æ»¤é˜ˆå€¼è®¾ç½®</text>
  <text x="120" y="855" class="small-text">â€¢ TweetTable: æ•°æ®è¡¨æ ¼å±•ç¤º</text>
  
  <text x="100" y="885" class="text">æ ¸å¿ƒHookï¼šuseTweets()</text>
  <text x="120" y="905" class="code">const [tweets, setTweets] = useState&lt;Tweet[]&gt;([])</text>
  <text x="120" y="925" class="small-text">ç›‘å¬æ¶ˆæ¯ï¼šchrome.runtime.onMessage.addListener()</text>
  <text x="120" y="945" class="small-text">æ”¶åˆ°SCRAPED_DATA â†’ æ›´æ–°tweetsçŠ¶æ€ â†’ è§¦å‘UIé‡æ¸²æŸ“</text>
  
  <text x="100" y="975" class="text">ç”¨æˆ·æ“ä½œï¼š</text>
  <text x="120" y="995" class="small-text">ç‚¹å‡»"å¼€å§‹" â†’ å‘é€START_SCRAPEæ¶ˆæ¯åˆ°Content Script</text>
  <text x="120" y="1015" class="small-text">ç‚¹å‡»"åœæ­¢" â†’ å‘é€STOP_SCRAPEæ¶ˆæ¯</text>

  <!-- Phase 6: Data Flow -->
  <rect x="50" y="1070" width="1300" height="280" class="box" rx="8" stroke="#16a34a" stroke-width="3"/>
  <circle cx="80" cy="1100" r="18" class="number-circle"/>
  <text x="80" y="1107" class="number-text">6</text>
  <text x="110" y="1107" class="subtitle" fill="#16a34a">å®Œæ•´æ•°æ®æµå‘</text>
  
  <!-- Data Flow Diagram -->
  <g transform="translate(100, 1130)">
    <!-- Box 1: DOM -->
    <rect x="0" y="0" width="180" height="80" fill="#fef3c7" stroke="#f59e0b" stroke-width="2" rx="5"/>
    <text x="90" y="30" class="section-title" text-anchor="middle">ç½‘é¡µ DOM</text>
    <text x="90" y="50" class="small-text" text-anchor="middle">Twitteræ¨æ–‡åˆ—è¡¨</text>
    <text x="90" y="70" class="code" text-anchor="middle">&lt;article&gt;</text>
    
    <!-- Box 2: Scraper -->
    <rect x="230" y="0" width="180" height="80" fill="#dcfce7" stroke="#22c55e" stroke-width="2" rx="5"/>
    <text x="320" y="30" class="section-title" text-anchor="middle">Scraperè§£æ</text>
    <text x="320" y="50" class="small-text" text-anchor="middle">querySelectorAll()</text>
    <text x="320" y="70" class="small-text" text-anchor="middle">æå–å­—æ®µ â†’ Tweetå¯¹è±¡</text>
    
    <!-- Box 3: Content Script -->
    <rect x="460" y="0" width="180" height="80" fill="#dcfce7" stroke="#22c55e" stroke-width="2" rx="5"/>
    <text x="550" y="25" class="section-title" text-anchor="middle">Content Script</text>
    <text x="550" y="45" class="small-text" text-anchor="middle">å»é‡ (Map)</text>
    <text x="550" y="60" class="code" text-anchor="middle">sendMessage()</text>
    <text x="550" y="75" class="small-text" text-anchor="middle">SCRAPED_DATA</text>
    
    <!-- Box 4: Message Bus -->
    <rect x="690" y="0" width="180" height="80" fill="#e0e7ff" stroke="#6366f1" stroke-width="2" rx="5"/>
    <text x="780" y="30" class="section-title" text-anchor="middle">Chromeæ¶ˆæ¯æ€»çº¿</text>
    <text x="780" y="50" class="code" text-anchor="middle">runtime.sendMessage</text>
    <text x="780" y="70" class="code" text-anchor="middle">runtime.onMessage</text>
    
    <!-- Box 5: React State -->
    <rect x="920" y="0" width="180" height="80" fill="#fce7f3" stroke="#ec4899" stroke-width="2" rx="5"/>
    <text x="1010" y="30" class="section-title" text-anchor="middle">React State</text>
    <text x="1010" y="50" class="code" text-anchor="middle">setTweets()</text>
    <text x="1010" y="70" class="small-text" text-anchor="middle">çŠ¶æ€æ›´æ–°</text>
    
    <!-- Arrows -->
    <path d="M 180 40 L 230 40" class="arrow-data"/>
    <path d="M 410 40 L 460 40" class="arrow-data"/>
    <path d="M 640 40 L 690 40" class="arrow-data"/>
    <path d="M 870 40 L 920 40" class="arrow-data"/>
    
    <!-- Arrow labels -->
    <text x="205" y="30" class="small-text" text-anchor="middle" fill="#16a34a">â‘ </text>
    <text x="435" y="30" class="small-text" text-anchor="middle" fill="#16a34a">â‘¡</text>
    <text x="665" y="30" class="small-text" text-anchor="middle" fill="#16a34a">â‘¢</text>
    <text x="895" y="30" class="small-text" text-anchor="middle" fill="#16a34a">â‘£</text>
    
    <!-- Final Box: UI -->
    <rect x="370" y="120" width="350" height="60" fill="#fce7f3" stroke="#ec4899" stroke-width="2" rx="5"/>
    <text x="545" y="145" class="section-title" text-anchor="middle">UI æ¸²æŸ“æ›´æ–°</text>
    <text x="545" y="165" class="small-text" text-anchor="middle">TweetTable æ˜¾ç¤ºæ•°æ® â†’ ç”¨æˆ·å¯è§</text>
    
    <path d="M 1010 80 L 1010 100 L 545 100 L 545 120" class="arrow-data"/>
    <text x="775" y="95" class="small-text" fill="#16a34a">â‘¤ è§¦å‘æ¸²æŸ“</text>
  </g>

  <!-- Phase 7: Key Techniques -->
  <rect x="50" y="1380" width="630" height="300" class="box" rx="8"/>
  <text x="80" y="1415" class="subtitle">å…³é”®æŠ€æœ¯è¦ç‚¹</text>
  
  <text x="80" y="1445" class="section-title">1. DOM é€‰æ‹©å™¨ç­–ç•¥</text>
  <text x="100" y="1465" class="code">SELECTORS.TWITTER.ARTICLE = 'article[data-testid="tweet"]'</text>
  <text x="100" y="1485" class="small-text">â†’ ä½¿ç”¨data-testidæ˜¯å› ä¸ºTwitterç”¨å®ƒæ ‡è¯†åŠŸèƒ½å…ƒç´ </text>
  
  <text x="80" y="1515" class="section-title">2. æ•°æ®å»é‡æœºåˆ¶</text>
  <text x="100" y="1535" class="code">scrapedTweets = new Map&lt;string, Tweet&gt;()</text>
  <text x="100" y="1555" class="small-text">â†’ ä½¿ç”¨æ¨æ–‡URLä½œä¸ºå”¯ä¸€IDï¼ŒMapè‡ªåŠ¨å»é‡</text>
  
  <text x="80" y="1585" class="section-title">3. å†…å­˜ä¿æŠ¤</text>
  <text x="100" y="1605" class="code">MAX_TWEETS = 3000</text>
  <text x="100" y="1625" class="small-text">â†’ è¶…è¿‡é™åˆ¶ååˆ é™¤æ—§æ•°æ®ï¼Œé˜²æ­¢å†…å­˜æº¢å‡º</text>
  
  <text x="80" y="1655" class="section-title">4. è‡ªåŠ¨æ»šåŠ¨åŠ è½½</text>
  <text x="100" y="1675" class="code">window.scrollBy({ top: 800-1200, behavior: 'instant' })</text>

  <!-- Phase 8: Message Types -->
  <rect x="720" y="1380" width="630" height="300" class="box" rx="8"/>
  <text x="750" y="1415" class="subtitle">æ¶ˆæ¯ç±»å‹ï¼ˆChromeé€šä¿¡åè®®ï¼‰</text>
  
  <text x="750" y="1445" class="section-title">UI â†’ Content Script</text>
  <text x="770" y="1465" class="code">START_SCRAPE</text>
  <text x="770" y="1485" class="small-text">å¯åŠ¨æŠ“å–</text>
  <text x="770" y="1505" class="code">STOP_SCRAPE</text>
  <text x="770" y="1525" class="small-text">åœæ­¢æŠ“å–</text>
  <text x="770" y="1545" class="code">CLEAR_DATA</text>
  <text x="770" y="1565" class="small-text">æ¸…ç©ºæ•°æ®</text>
  <text x="770" y="1585" class="code">REQUEST_FULL_DATA</text>
  <text x="770" y="1605" class="small-text">è¯·æ±‚æ‰€æœ‰å·²æŠ“å–æ•°æ®</text>
  
  <text x="750" y="1635" class="section-title">Content Script â†’ UI</text>
  <text x="770" y="1655" class="code">SCRAPED_DATA + payload: Tweet[]</text>
  <text x="770" y="1675" class="small-text">å‘é€æ–°æŠ“å–çš„æ¨æ–‡æ•°æ®</text>

  <!-- Summary -->
  <rect x="50" y="1710" width="1300" height="260" class="box" rx="8" fill="#f0fdf4" stroke="#22c55e" stroke-width="3"/>
  <text x="700" y="1745" class="subtitle" text-anchor="middle" fill="#16a34a">ğŸ¯ å¼€å‘è‡ªå·±çš„Chromeçˆ¬è™«æ’ä»¶ - å…³é”®æ­¥éª¤</text>
  
  <text x="80" y="1780" class="section-title">ç¬¬1æ­¥ï¼šåˆ›å»º manifest.json</text>
  <text x="100" y="1800" class="small-text">å®šä¹‰permissions (activeTab, scripting)ã€host_permissions (ç›®æ ‡ç½‘ç«™)ã€content_scripts (æ³¨å…¥è„šæœ¬)</text>
  
  <text x="80" y="1830" class="section-title">ç¬¬2æ­¥ï¼šç¼–å†™ content.ts (æ ¸å¿ƒæŠ“å–é€»è¾‘)</text>
  <text x="100" y="1850" class="small-text">â€¢ ä½¿ç”¨ document.querySelector() å®šä½ç›®æ ‡å…ƒç´  (åˆ†æç½‘é¡µDOMç»“æ„æ˜¯å…³é”®ï¼)</text>
  <text x="100" y="1870" class="small-text">â€¢ æå–æ–‡æœ¬ã€å±æ€§ã€é“¾æ¥ç­‰æ•°æ®</text>
  <text x="100" y="1890" class="small-text">â€¢ é€šè¿‡ chrome.runtime.sendMessage() å‘é€æ•°æ®åˆ°UI</text>
  
  <text x="80" y="1920" class="section-title">ç¬¬3æ­¥ï¼šæ„å»º UI (React/Vue/åŸç”ŸHTML)</text>
  <text x="100" y="1940" class="small-text">â€¢ ç›‘å¬æ¶ˆæ¯ chrome.runtime.onMessage.addListener()</text>
  <text x="100" y="1960" class="small-text">â€¢ å±•ç¤ºæ•°æ®ã€æä¾›å¯¼å‡ºåŠŸèƒ½</text>

</svg>
