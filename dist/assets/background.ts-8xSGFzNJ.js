chrome.sidePanel.setPanelBehavior({openPanelOnActionClick:!0}).catch(t=>console.error(t));const a=async(t,e)=>{try{const s=new URL(e),n=s.hostname==="twitter.com"||s.hostname==="x.com"||s.hostname.endsWith(".twitter.com")||s.hostname.endsWith(".x.com"),o=s.hostname==="substack.com"||s.hostname.endsWith(".substack.com");n||o?await chrome.sidePanel.setOptions({tabId:t,path:"src/sidepanel.html",enabled:!0}):await chrome.sidePanel.setOptions({tabId:t,enabled:!1})}catch{try{await chrome.sidePanel.setOptions({tabId:t,enabled:!1})}catch{}}};chrome.tabs.onUpdated.addListener((t,e,s)=>{e.url?a(t,e.url):e.status==="complete"&&s.url&&a(t,s.url)});chrome.tabs.onActivated.addListener(async t=>{try{const e=await chrome.tabs.get(t.tabId);e.url&&a(t.tabId,e.url)}catch(e){console.warn("Failed to get tab info on activation:",e)}});chrome.runtime.onInstalled.addListener(async()=>{await chrome.sidePanel.setOptions({enabled:!1});const t=await chrome.tabs.query({});for(const e of t)e.id&&e.url&&a(e.id,e.url)});
